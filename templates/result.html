{% extends 'base.html' %}
{% block content %}
<section class="card">
	<h2>Your Results</h2>
	<p id="scoreText">Loading...</p>
	<!-- reward/leaderboard removed -->
	<div id="detailContainer"></div>
	<!-- leaderboard removed -->
	<a class="btn" href="/">Back to Home</a>
</section>
<script>
(function(){
	const sp = new URLSearchParams(location.search);
	const score = Number(sp.get('score'))||0; // this may include speed bonus
	const total = 50; // fixed quiz length per section
	const data = JSON.parse(sessionStorage.getItem('quiz_details')||'{}');
	// Compute base correct answers from server details to avoid speed bonus in percentage
	const correctCount = Array.isArray(data.serverDetails) ? data.serverDetails.filter(d=> d && d.is_correct).length : 0;
	const pct = total ? Math.round((correctCount/total)*100) : 0;
	document.getElementById('scoreText').textContent = `Score: ${correctCount} / ${total} (${pct}%)`;
	// rewards removed
	// Details
	const container = document.getElementById('detailContainer');
	const list = document.createElement('ol');
	list.style.paddingLeft = '20px';
	(data.questions||[]).forEach((q, idx)=>{
		const li = document.createElement('li');
		li.style.marginBottom = '10px';
		const server = (data.serverDetails||[]).find(d=>d.id===q.id) || {};
		const chosen = (data.answers||[])[idx]?.choice_index;
		const correctIdx = server.correct_index ?? q.correct_index;
		const isCorrect = server.is_correct ?? (typeof chosen==='number' && chosen===correctIdx);
		const qEl = document.createElement('div');
		qEl.textContent = q.question;
		li.appendChild(qEl);
		const opts = document.createElement('ul');
		opts.style.listStyle = 'none';
		opts.style.padding = '0';
		q.options.forEach((opt, i)=>{
			const oi = document.createElement('li');
			const mark = i===correctIdx ? '✓' : (i===chosen ? '✗' : '•');
			const color = i===correctIdx ? '#22c55e' : (i===chosen ? '#ef4444' : '#94a3b8');
			oi.textContent = `${mark} ${opt}`;
			oi.style.color = color;
			opts.appendChild(oi);
		});
		const result = document.createElement('div');
		result.textContent = isCorrect ? 'Correct' : 'Incorrect';
		result.style.color = isCorrect ? '#22c55e' : '#ef4444';
		result.style.fontWeight = '700';
		li.appendChild(opts);
		li.appendChild(result);
		list.appendChild(li);
	});
	container.appendChild(list);
	// leaderboard removed
})();
</script>
{% endblock %}

